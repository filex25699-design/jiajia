<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ„ åœ£è¯å¿«ä¹ ä½³ä½³</title>
    <style>
        /* --- å…¨å±€è®¾ç½® --- */
        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            color: white;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- 1. å¯åŠ¨é¡µ (å¿…é¡»æœ‰è¿™ä¸ªæ‰èƒ½è§£é”å£°éŸ³) --- */
        #start-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.8s;
        }

        .start-btn {
            background: #c0392b;
            color: white;
            font-size: 22px;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.6);
            animation: pulseBtn 1.5s infinite;
            margin-top: 30px;
        }

        @keyframes pulseBtn {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* --- 2. ä¸»åœºæ™¯ --- */
        #main-scene {
            opacity: 0; /* åˆå§‹éšè— */
            transition: opacity 1.5s;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 10;
        }

        /* é›ªèŠ±ç”»å¸ƒ */
        #snow-canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        /* éŸ³ä¹æ§åˆ¶æŒ‰é’® */
        .music-toggle {
            position: absolute;
            top: 20px; right: 20px;
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 100;
            border: 1px solid rgba(255,255,255,0.3);
            font-size: 24px;
        }
        .spinning { animation: spin 4s linear infinite; }

        /* åœ£è¯æ ‘å®¹å™¨ */
        .tree-container {
            position: relative;
            filter: drop-shadow(0 0 15px rgba(46, 204, 113, 0.5));
            animation: float 4s ease-in-out infinite;
            cursor: pointer;
            margin-bottom: 20px;
        }
        
        .star-glow {
            transform-origin: center;
            animation: starShine 2s infinite alternate;
        }

        /* äº’åŠ¨äººç‰© */
        .footer-box {
            display: flex;
            justify-content: center;
            gap: 60px;
            margin-top: -20px;
            z-index: 20;
        }

        .character {
            width: 90px; height: 90px;
            cursor: pointer;
            transition: transform 0.2s;
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.5));
        }
        .character:active { transform: scale(0.9); }
        
        .santa-anim { animation: rock 3s ease-in-out infinite alternate; }
        .gift-anim { animation: rock 4s ease-in-out infinite alternate-reverse; }

        /* æ ‡é¢˜ */
        .title {
            font-family: 'Brush Script MT', cursive;
            font-size: 3.5rem;
            margin-top: 30px;
            background: linear-gradient(to right, #fff, #f1c40f, #fff);
            -webkit-background-clip: text;
            color: transparent;
            text-shadow: 0 0 15px rgba(241, 196, 15, 0.5);
            text-align: center;
        }

        /* --- å¼¹çª—æ ·å¼ --- */
        .modal {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center; align-items: center;
            backdrop-filter: blur(4px);
        }
        .modal-content {
            background: #fff8e1;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            width: 80%;
            max-width: 320px;
            border: 4px solid #c0392b;
            box-shadow: 0 0 30px rgba(255,215,0,0.5);
            transform: scale(0.8);
            opacity: 0;
            transition: all 0.3s;
        }
        .modal.show .modal-content { transform: scale(1); opacity: 1; }
        .modal h3 { color: #d35400; margin-top: 0; }
        .modal p { color: #333; font-size: 1.1rem; line-height: 1.6; }
        .close-btn {
            background: #27ae60; color: white; border: none;
            padding: 10px 25px; border-radius: 20px; font-size: 16px;
            margin-top: 20px; cursor: pointer;
        }

        /* åŠ¨ç”»å®šä¹‰ */
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes float { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes starShine { from { filter: drop-shadow(0 0 5px gold); } to { filter: drop-shadow(0 0 20px gold); } }
        @keyframes rock { 0% { transform: rotate(-3deg); } 100% { transform: rotate(3deg); } }

        /* é€‚é…æ‰‹æœº */
        @media (max-width: 600px) {
            .title { font-size: 2.8rem; }
            .tree-container svg { width: 260px; height: 320px; }
        }
    </style>
</head>
<body>

    <div id="start-overlay">
        <div style="font-size: 60px; margin-bottom: 20px;">ğŸ„</div>
        <div style="font-size: 18px; color: #eee;">ä½³ä½³ï¼Œæœ‰ä¸€ä»½ä¸“å±ç¤¼ç‰©</div>
        <button class="start-btn" onclick="initPage()">ç‚¹å‡»å¼€å¯</button>
    </div>

    <div id="main-scene">
        <canvas id="snow-canvas"></canvas>
        <div class="music-toggle" id="musicBtn" onclick="toggleMute()">ğŸµ</div>

        <div class="tree-container" onclick="showModal('ğŸ„ åœ£è¯æ ‘', 'æ„¿è¿™æ£µæ ‘çš„æ˜Ÿå…‰<br>ç…§äº®ä½ æœªæ¥çš„æ¯ä¸€å¤©<br>æ°¸è¿œå¼€å¿ƒå¿«ä¹ï¼')">
            <svg width="300" height="380" viewBox="0 0 200 260">
                <rect x="90" y="220" width="20" height="40" fill="#5D4037" rx="2" />
                <path d="M20,230 Q100,260 180,230 L160,190 L180,190 Q100,220 20,190 L40,190 L20,230 Z" fill="#1B5E20" />
                <path d="M30,220 Q100,250 170,220 Q150,160 100,140 Q50,160 30,220" fill="#2E7D32" />
                <path d="M40,160 Q100,190 160,160 Q145,110 100,90 Q55,110 40,160" fill="#43A047" />
                <path d="M55,100 Q100,120 145,100 Q130,60 100,30 Q70,60 55,100" fill="#66BB6A" />
                <circle cx="70" cy="180" r="6" fill="#c0392b" />
                <circle cx="140" cy="170" r="6" fill="#f1c40f" />
                <circle cx="90" cy="150" r="6" fill="#3498db" />
                <circle cx="110" cy="200" r="5" fill="#fff" opacity="0.9" />
                <g class="star-glow">
                    <path transform="translate(100, 30) scale(0.9)" d="M0,-15 L4,-4 L15,-4 L6,3 L9,14 L0,8 L-9,14 L-6,3 L-15,-4 L-4,-4 Z" fill="#FFD700" />
                </g>
            </svg>
        </div>

        <div class="footer-box">
            <div class="character santa-anim" onclick="showModal('ğŸ… åœ£è¯è€äºº', 'HoHoHo~<br>ä¸ç®¡ä¸–ç•Œæ€ä¹ˆå˜<br>æˆ‘éƒ½ä¼šä¸€ç›´å®ˆæŠ¤ä½ ï¼')">
                <svg width="100%" height="100%" viewBox="0 0 100 100">
                    <path d="M20,40 Q50,10 80,40 L75,55 L25,55 Z" fill="#D32F2F" />
                    <circle cx="80" cy="40" r="8" fill="#FFF" />
                    <rect x="20" y="50" width="60" height="12" rx="6" fill="#FFF" />
                    <circle cx="50" cy="65" r="22" fill="#FFCCBC" />
                    <circle cx="43" cy="62" r="2.5" fill="#333" />
                    <circle cx="57" cy="62" r="2.5" fill="#333" />
                    <path d="M28,70 Q50,95 72,70 Q78,75 72,88 Q50,105 28,88 Q22,75 28,70" fill="#FFF" />
                    <circle cx="50" cy="68" r="4" fill="#e74c3c" />
                </svg>
            </div>
            <div class="character gift-anim" onclick="showModal('ğŸ æƒŠå–œç¤¼ç‰©', 'å®ï¼å¥½è¿å·²åˆ°è´¦ï¼<br>ç¥æˆ‘ä»¬å¹³å¹³å®‰å®‰ï¼Œé¡ºé¡ºåˆ©åˆ©ï¼')">
                <svg width="100%" height="100%" viewBox="0 0 100 100">
                    <rect x="20" y="40" width="60" height="45" rx="4" fill="#C0392B" />
                    <rect x="15" y="35" width="70" height="15" rx="3" fill="#E74C3C" />
                    <rect x="45" y="35" width="10" height="50" fill="#F1C40F" />
                    <circle cx="50" cy="35" r="8" fill="#F1C40F" />
                </svg>
            </div>
        </div>

        <div class="title">Merry Christmas</div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <h3 id="m-title"></h3>
            <p id="m-content"></p>
            <button class="close-btn" onclick="closeModal()">æ”¶ä¸‹ç¥ç¦ â¤ï¸</button>
        </div>
    </div>

    <script>
        // --- æ ¸å¿ƒï¼šéŸ³é¢‘åˆæˆå™¨ (ä¸ä¾èµ–å¤–éƒ¨é“¾æ¥) ---
        const AudioEngine = {
            ctx: null,
            isPlaying: false,
            osc: null,
            timer: null,
            noteIndex: 0,
            
            // Jingle Bells ç®€è°± (é¢‘ç‡+æ—¶å€¼)
            melody: [
                {f: 329.6, d: 200}, {f: 329.6, d: 200}, {f: 329.6, d: 400}, // 3 3 3-
                {f: 0, d: 100}, // ä¼‘æ­¢
                {f: 329.6, d: 200}, {f: 329.6, d: 200}, {f: 329.6, d: 400}, // 3 3 3-
                {f: 0, d: 100},
                {f: 329.6, d: 200}, {f: 392.0, d: 200}, {f: 261.6, d: 300}, {f: 293.7, d: 100}, {f: 329.6, d: 800}, // 3 5 1 2 3---
                {f: 0, d: 200},
                {f: 349.2, d: 200}, {f: 349.2, d: 200}, {f: 349.2, d: 300}, {f: 349.2, d: 100}, // 4 4 4 4
                {f: 349.2, d: 200}, {f: 329.6, d: 200}, {f: 329.6, d: 200}, {f: 329.6, d: 100}, {f: 329.6, d: 100}, // 4 3 3 33
                {f: 329.6, d: 200}, {f: 293.7, d: 200}, {f: 293.7, d: 200}, {f: 329.6, d: 200}, // 3 2 2 3
                {f: 293.7, d: 400}, {f: 392.0, d: 400}, // 2- 5-
                {f: 0, d: 400} // å¾ªç¯é—´éš”
            ],

            init() {
                window.AudioContext = window.AudioContext || window.webkitAudioContext;
                this.ctx = new AudioContext();
            },

            playNote(freq, duration) {
                if (freq <= 0) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'triangle'; // ä¸‰è§’æ³¢ï¼Œå¬èµ·æ¥åƒå…«éŸ³ç›’
                osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                
                // éŸ³é‡åŒ…ç»œ (æ·¡å…¥æ·¡å‡ºï¼Œé˜²æ­¢çˆ†éŸ³)
                gain.gain.setValueAtTime(0, this.ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0.1, this.ctx.currentTime + 0.05);
                gain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + duration/1000);

                osc.start();
                osc.stop(this.ctx.currentTime + duration/1000);
            },

            loop() {
                if (!this.isPlaying) return;
                const note = this.melody[this.noteIndex];
                this.playNote(note.f, note.d);
                
                this.noteIndex = (this.noteIndex + 1) % this.melody.length;
                this.timer = setTimeout(() => this.loop(), note.d * 1.1); // ç¨å¾®åŠ ç‚¹é—´éš”
            },

            start() {
                if (this.ctx.state === 'suspended') this.ctx.resume();
                if (this.isPlaying) return;
                this.isPlaying = true;
                this.noteIndex = 0;
                this.loop();
            },

            stop() {
                this.isPlaying = false;
                clearTimeout(this.timer);
            },

            // ç®€å•çš„ç‚¹å‡»éŸ³æ•ˆ
            playClick() {
                if (this.ctx.state === 'suspended') this.ctx.resume();
                const o = this.ctx.createOscillator();
                const g = this.ctx.createGain();
                o.connect(g);
                g.connect(this.ctx.destination);
                o.frequency.setValueAtTime(800, this.ctx.currentTime);
                o.frequency.exponentialRampToValueAtTime(300, this.ctx.currentTime + 0.1);
                g.gain.setValueAtTime(0.2, this.ctx.currentTime);
                g.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.1);
                o.start();
                o.stop(this.ctx.currentTime + 0.1);
            }
        };

        // --- é¡µé¢é€»è¾‘ ---
        
        // 1. åˆå§‹åŒ–
        function initPage() {
            // åˆå§‹åŒ–éŸ³é¢‘å¼•æ“
            AudioEngine.init();
            AudioEngine.start();
            
            // ç•Œé¢åŠ¨ç”»
            const overlay = document.getElementById('start-overlay');
            const scene = document.getElementById('main-scene');
            const btn = document.getElementById('musicBtn');
            
            overlay.style.opacity = '0';
            setTimeout(() => {
                overlay.style.display = 'none';
                scene.style.opacity = '1';
                btn.classList.add('spinning');
            }, 800);
        }

        // 2. éŸ³ä¹å¼€å…³
        function toggleMute() {
            const btn = document.getElementById('musicBtn');
            if (AudioEngine.isPlaying) {
                AudioEngine.stop();
                btn.classList.remove('spinning');
                btn.style.opacity = '0.5';
            } else {
                AudioEngine.start();
                btn.classList.add('spinning');
                btn.style.opacity = '1';
            }
        }

        // 3. å¼¹çª—æ§åˆ¶
        const modal = document.getElementById('modal');
        function showModal(title, content) {
            AudioEngine.playClick(); // æ’­æ”¾éŸ³æ•ˆ
            document.getElementById('m-title').innerHTML = title;
            document.getElementById('m-content').innerHTML = content;
            modal.style.display = 'flex';
            setTimeout(() => modal.classList.add('show'), 10);
        }

        function closeModal() {
            AudioEngine.playClick();
            modal.classList.remove('show');
            setTimeout(() => modal.style.display = 'none', 300);
        }

        // 4. é›ªèŠ±æ•ˆæœ
        const canvas = document.getElementById('snow-canvas');
        const ctx = canvas.getContext('2d');
        let w, h;
        const flakes = [];

        function resize() { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize);
        resize();

        function createFlake() {
            return {
                x: Math.random() * w, y: Math.random() * -h,
                r: Math.random() * 3 + 1,
                s: Math.random() * 1 + 0.5
            };
        }
        for(let i=0; i<80; i++) flakes.push(createFlake());

        function drawSnow() {
            ctx.clearRect(0, 0, w, h);
            ctx.fillStyle = 'rgba(255,255,255,0.7)';
            ctx.beginPath();
            flakes.forEach(f => {
                ctx.moveTo(f.x, f.y);
                ctx.arc(f.x, f.y, f.r, 0, Math.PI*2);
                f.y += f.s;
                if(f.y > h) f.y = -10;
            });
            ctx.fill();
            requestAnimationFrame(drawSnow);
        }
        drawSnow();

    </script>
</body>
</html>
